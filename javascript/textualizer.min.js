(function(d){function l(){this.str="";this.characterList=[]}function q(){this.pos=this.domNode=this.character=null;this.visited=this.inserted=this.used=!1}function k(b){var a,c={};if(window.getComputedStyle)if(a=window.getComputedStyle(b,null),a.length)d.each(a,function(){var b=this.replace(/\-([a-z])/,function(c,b){return b.toUpperCase()}),d=a.getPropertyValue(this);c[b]=d});else for(var e in a)"function"!==typeof a[e]&&"length"!==e&&(c[e]=a[e]);else for(e in a=b.currentStyle||b.style,a)Object.prototype.hasOwnProperty.call(a,
e)&&(c[e]=a[e]);return c}function j(b,a,c){this.options=c;this._showCharEffect=null;var e=this;"random"!==this.options.effect&&d.each(d.fn.textualizer.effects,function(){if(this.name===c.effect)return e._showCharEffect=this.fn,!1});var f=b.clone().removeAttr("id").appendTo(document.body);f.css(k(b[0]));f.css({position:"absolute",top:"-1000px"});this.phantomContainer=d("<div />").css({position:"relative",visibility:"hidden"}).appendTo(f);b.css("overflow","hidden");this.elementHeight=b.height();this.container=
d("<div />").css("position","relative").appendTo(b);this._previous=null;this._position={bottom:b.height()};this.blurbs=[];this.elem=b;a&&a instanceof Array&&this.data(a)}function r(){var b=this,a=[function(c){var a=d.Deferred();c.animate({top:b._position.bottom,opacity:"hide"},a.resolve);return a.promise()},function(c){var b=d.Deferred();c.fadeOut(1E3,b.resolve);return b.promise()}];return a[Math.floor(Math.random()*a.length)]}function m(b){var a=this,c=d.fn.textualizer.effects,e="random"===this.options.effect?
c[Math.floor(Math.random()*(c.length-2))+1].fn:this._showCharEffect,f=d.Deferred(),g=[];d.each(b.characterList,function(c,b){if(!b.inserted){b.domNode.css({left:b.pos.left,top:b.pos.top});var f=d.Deferred();setTimeout(function(){e.call(a,b,f)},Math.random()*s);g.push(f)}});d.when.apply(null,g).done(function(){f.resolve()});return f.promise()}var s=2E3;d.fn.textualizer=function(b,a){var c=arguments,e=function(b){var a=b.data("textualizer");if(!a){var e=[],i;1===c.length&&c[0]instanceof Array?e=c[0]:
1===c.length&&"object"===typeof c[0]?i=c[0]:2===c.length&&(e=c[0],i=c[1]);0===e.length&&b.find("p").each(function(){e.push(d(this).text())});b.html("");a=new j(b,e,d.extend({},d.fn.textualizer.defaults,i));b.data("textualizer",a)}return a}(this);"string"===typeof c[0]&&e[c[0]]&&e[c[0]].apply(e,Array.prototype.slice.call(c,1));return this};d.fn.textualizer.defaults={effect:"random",duration:2E3,rearrangeDuration:1E3,centered:!1,loop:!0};d.fn.textualizer.effects=[{name:"none",fn:function(b){this.container.append(b.domNode.show())}},
{name:"fadeIn",fn:function(b,a){this.container.append(b.domNode.fadeIn(2E3,a.resolve));return a.promise()}},{name:"slideLeft",fn:function(b,a){b.domNode.appendTo(this.container).css({left:-1E3}).show().animate({left:b.pos.left},2E3,a.resolve);return a.promise()}},{name:"slideTop",fn:function(b,a){b.domNode.appendTo(this.container).css({top:-1E3}).show().animate({top:b.pos.top},2E3,a.resolve);return a.promise()}}];l.prototype={use:function(b){var a=null;d.each(this.characterList,function(){if(this.character===
b&&!this.used)return this.used=!0,a=this,!1});return a},reset:function(){d.each(this.characterList,function(){this.used=this.inserted=!1})}};j.prototype={data:function(b){this.stop();this.list=b;this.blurbs=[]},start:function(){function b(b){a._pause||a._rotate(b).done(function(){e.trigger("textualzer.blurbchanged",{index:b});setTimeout(f,a.options.duration)})}if(this.list&&!(0===this.list.length||this._playing)){var a=this,c=this._index||0,e=this.elem;this._playing=!0;this._pause=!1;var f=function(a){return function(){c===
a.list.length-1&&(d.each(a.blurbs,function(b,a){a.reset()}),c=-1,a.options.loop||a.pause());c++;a._index=c;b(c)}}(this);b(c)}},stop:function(){this.pause();this._playing=!1;this._previous=null;this._index=0;this.container.empty();this.phantomContainer.empty()},pause:function(){this._pause=!0;this._playing=!1},_rotate:function(b){var a=d.Deferred(),c=this.blurbs[b];if(!c){var e=[],f,g,h,c=new l;c.str=this.list[b];this.blurbs.push(c);b=0;for(f=c.str.length;b<f;b++)g=c.str.charAt(b),""===g?this.phantomContainer.append(" "):
(h=new q,h.character=g,h.domNode=d("<span/>").text(g),this.phantomContainer.append(h.domNode),e.push(h));var i=this.options.centered?(this.elementHeight-this.phantomContainer.height())/2:0;d.each(e,function(b,a){a.pos=a.domNode.position();a.domNode=a.domNode.clone();a.pos.top+=i;a.domNode.css({left:a.pos.left,top:a.pos.top,position:"absolute"});c.characterList.push(a)});this.phantomContainer.html("")}if(this._previous){var j=this,n=[],o=[],p=[],k=r.call(this);d.each(this._previous.characterList,function(a,
b){var e=c.use(b.character);if(e)e.domNode=b.domNode,e.inserted=!0,n.push(e);else{var f=d.Deferred();o.push(f);k(b.domNode.delay(2E3*Math.random())).done(function(){b.domNode.remove();f.resolve()})}});d.when.apply(null,o).done(function(){setTimeout(function(){d.each(n,function(b,a){var c=d.Deferred();a.domNode.animate({left:a.pos.left,top:a.pos.top},j.options.rearrangeDuration,c.resolve);p.push(c.promise())});d.when.apply(null,p).done(function(){setTimeout(function(){m.call(j,c).done(function(){a.resolve()})},
500)})},1E3)})}else m.call(this,c).done(function(){a.resolve()});this._previous=c;return a.promise()},destroy:function(){this.container.parent().removeData("textualizer").end().remove();this.phantomContainer.remove()}}})(jQuery);